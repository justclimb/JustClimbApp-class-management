{"ast":null,"code":"import { __assign } from \"tslib\";\nimport RRule from './rrule';\nimport RRuleSet from './rruleset';\nimport dateutil from './dateutil';\nimport { includes, split } from './helpers';\nimport { parseString, parseDtstart } from './parsestring';\n/**\n * RRuleStr\n *  To parse a set of rrule strings\n */\nvar DEFAULT_OPTIONS = {\n  dtstart: null,\n  cache: false,\n  unfold: false,\n  forceset: false,\n  compatible: false,\n  tzid: null\n};\nexport function parseInput(s, options) {\n  var rrulevals = [];\n  var rdatevals = [];\n  var exrulevals = [];\n  var exdatevals = [];\n  var _a = parseDtstart(s),\n    dtstart = _a.dtstart,\n    tzid = _a.tzid;\n  var lines = splitIntoLines(s, options.unfold);\n  lines.forEach(function (line) {\n    if (!line) return;\n    var _a = breakDownLine(line),\n      name = _a.name,\n      parms = _a.parms,\n      value = _a.value;\n    switch (name.toUpperCase()) {\n      case 'RRULE':\n        if (parms.length) {\n          throw new Error(\"unsupported RRULE parm: \" + parms.join(','));\n        }\n        rrulevals.push(parseString(line));\n        break;\n      case 'RDATE':\n        var _b = /RDATE(?:;TZID=([^:=]+))?/i.exec(line),\n          _ = _b[0],\n          rdateTzid = _b[1];\n        if (rdateTzid && !tzid) {\n          tzid = rdateTzid;\n        }\n        rdatevals = rdatevals.concat(parseRDate(value, parms));\n        break;\n      case 'EXRULE':\n        if (parms.length) {\n          throw new Error(\"unsupported EXRULE parm: \" + parms.join(','));\n        }\n        exrulevals.push(parseString(value));\n        break;\n      case 'EXDATE':\n        exdatevals = exdatevals.concat(parseRDate(value, parms));\n        break;\n      case 'DTSTART':\n        break;\n      default:\n        throw new Error('unsupported property: ' + name);\n    }\n  });\n  return {\n    dtstart: dtstart,\n    tzid: tzid,\n    rrulevals: rrulevals,\n    rdatevals: rdatevals,\n    exrulevals: exrulevals,\n    exdatevals: exdatevals\n  };\n}\nfunction buildRule(s, options) {\n  var _a = parseInput(s, options),\n    rrulevals = _a.rrulevals,\n    rdatevals = _a.rdatevals,\n    exrulevals = _a.exrulevals,\n    exdatevals = _a.exdatevals,\n    dtstart = _a.dtstart,\n    tzid = _a.tzid;\n  var noCache = options.cache === false;\n  if (options.compatible) {\n    options.forceset = true;\n    options.unfold = true;\n  }\n  if (options.forceset || rrulevals.length > 1 || rdatevals.length || exrulevals.length || exdatevals.length) {\n    var rset_1 = new RRuleSet(noCache);\n    rset_1.dtstart(dtstart);\n    rset_1.tzid(tzid || undefined);\n    rrulevals.forEach(function (val) {\n      rset_1.rrule(new RRule(groomRruleOptions(val, dtstart, tzid), noCache));\n    });\n    rdatevals.forEach(function (date) {\n      rset_1.rdate(date);\n    });\n    exrulevals.forEach(function (val) {\n      rset_1.exrule(new RRule(groomRruleOptions(val, dtstart, tzid), noCache));\n    });\n    exdatevals.forEach(function (date) {\n      rset_1.exdate(date);\n    });\n    if (options.compatible && options.dtstart) rset_1.rdate(dtstart);\n    return rset_1;\n  }\n  var val = rrulevals[0] || {};\n  return new RRule(groomRruleOptions(val, val.dtstart || options.dtstart || dtstart, val.tzid || options.tzid || tzid), noCache);\n}\nexport function rrulestr(s, options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return buildRule(s, initializeOptions(options));\n}\nfunction groomRruleOptions(val, dtstart, tzid) {\n  return __assign(__assign({}, val), {\n    dtstart: dtstart,\n    tzid: tzid\n  });\n}\nfunction initializeOptions(options) {\n  var invalid = [];\n  var keys = Object.keys(options);\n  var defaultKeys = Object.keys(DEFAULT_OPTIONS);\n  keys.forEach(function (key) {\n    if (!includes(defaultKeys, key)) invalid.push(key);\n  });\n  if (invalid.length) {\n    throw new Error('Invalid options: ' + invalid.join(', '));\n  }\n  return __assign(__assign({}, DEFAULT_OPTIONS), options);\n}\nfunction extractName(line) {\n  if (line.indexOf(':') === -1) {\n    return {\n      name: 'RRULE',\n      value: line\n    };\n  }\n  var _a = split(line, ':', 1),\n    name = _a[0],\n    value = _a[1];\n  return {\n    name: name,\n    value: value\n  };\n}\nfunction breakDownLine(line) {\n  var _a = extractName(line),\n    name = _a.name,\n    value = _a.value;\n  var parms = name.split(';');\n  if (!parms) throw new Error('empty property name');\n  return {\n    name: parms[0].toUpperCase(),\n    parms: parms.slice(1),\n    value: value\n  };\n}\nfunction splitIntoLines(s, unfold) {\n  if (unfold === void 0) {\n    unfold = false;\n  }\n  s = s && s.trim();\n  if (!s) throw new Error('Invalid empty string');\n  // More info about 'unfold' option\n  // Go head to http://www.ietf.org/rfc/rfc2445.txt\n  if (!unfold) {\n    return s.split(/\\s/);\n  }\n  var lines = s.split('\\n');\n  var i = 0;\n  while (i < lines.length) {\n    // TODO\n    var line = lines[i] = lines[i].replace(/\\s+$/g, '');\n    if (!line) {\n      lines.splice(i, 1);\n    } else if (i > 0 && line[0] === ' ') {\n      lines[i - 1] += line.slice(1);\n      lines.splice(i, 1);\n    } else {\n      i += 1;\n    }\n  }\n  return lines;\n}\nfunction validateDateParm(parms) {\n  parms.forEach(function (parm) {\n    if (!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(parm)) {\n      throw new Error('unsupported RDATE/EXDATE parm: ' + parm);\n    }\n  });\n}\nfunction parseRDate(rdateval, parms) {\n  validateDateParm(parms);\n  return rdateval.split(',').map(function (datestr) {\n    return dateutil.untilStringToDate(datestr);\n  });\n}","map":{"version":3,"names":["RRule","RRuleSet","dateutil","includes","split","parseString","parseDtstart","DEFAULT_OPTIONS","dtstart","cache","unfold","forceset","compatible","tzid","parseInput","s","options","rrulevals","rdatevals","exrulevals","exdatevals","_a","lines","splitIntoLines","forEach","line","breakDownLine","name","parms","value","toUpperCase","length","Error","join","push","_b","exec","_","rdateTzid","concat","parseRDate","buildRule","noCache","rset_1","undefined","val","rrule","groomRruleOptions","date","rdate","exrule","exdate","rrulestr","initializeOptions","__assign","invalid","keys","Object","defaultKeys","key","extractName","indexOf","slice","trim","i","replace","splice","validateDateParm","parm","test","rdateval","map","datestr","untilStringToDate"],"sources":["../../../src/rrulestr.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}